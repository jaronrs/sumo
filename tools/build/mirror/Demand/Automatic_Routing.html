<a id="top"></a>

						<div class="mw-indicators">
</div>
			<h1 id="firstHeading" class="firstHeading" lang="en">Demand/Automatic Routing</h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Sumo</div>
								<div id="contentSub"></div>
												
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Options"><span class="tocnumber">2</span> <span class="toctext">Options</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Edge_weights"><span class="tocnumber">3</span> <span class="toctext">Edge weights</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Adapting_by_exponential_average"><span class="tocnumber">3.1</span> <span class="toctext">Adapting by exponential average</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Adapting_by_moving_average"><span class="tocnumber">3.2</span> <span class="toctext">Adapting by moving average</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Investigating_edge_weights"><span class="tocnumber">3.3</span> <span class="toctext">Investigating edge weights</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Incomplete_trips_and_flows"><span class="tocnumber">4</span> <span class="toctext">Incomplete trips and flows</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Alternative_Declaration_via_Parameters"><span class="tocnumber">5</span> <span class="toctext">Alternative Declaration via Parameters</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#TraCI"><span class="tocnumber">6</span> <span class="toctext">TraCI</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Randomness"><span class="tocnumber">7</span> <span class="toctext">Randomness</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction">Introduction</span></h1>
<p>Routing dynamically in the running simulation may be adequate in the following situations:
</p>
<ul><li> there is not enough time / computing power to wait for the dynamic user equilibrium</li>
<li> changes to the net occur while the simulation is running</li>
<li> vehicles need to adapt their route while running</li></ul>
<p>In this case <a href="../SUMO.html" title="SUMO">SUMO</a> may be used directly for routing with either routes or trip files (or a mix) as input.
</p><p>This routing approach works by giving some or all vehicles the capability to re-compute their route periodically. This routing takes into account the current and recent state of traffic in the network and thus adapts to jams and other changes in the network.
</p><p>The options listed below allow configuring which of the vehicles shall be equipped, how often rerouting decisions shall be made and how the estimation of travel times is computed from current and recent knowledge.
</p>
<h1><span class="mw-headline" id="Options">Options</span></h1>
<p>The options related to this routing are:
</p>
<table cellspacing="0" border="1" width="90%" align="center">

<tr>
<th style="background:#ddffdd;" valign="top"> Option
</th>
<th style="background:#ddffdd;" valign="top"> default
</th>
<th style="background:#ddffdd;" valign="top"> Description
</th></tr>
<tr>
<td valign="top"> <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.probability <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;FLOAT&gt;</i></a></span>
</td>
<td> 0
</td>
<td valign="top"> The probability for a vehicle to have a routing device
</td></tr>
<tr>
<td valign="top"> <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.explicit <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;STRING&gt;</i></a></span>
</td>
<td>
</td>
<td valign="top"> Assign a device to named vehicles
</td></tr>
<tr>
<td valign="top"> <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.deterministic</span>
</td>
<td> false
</td>
<td valign="top"> The devices are set deterministic using a fraction of 1000 (with the defined <b>probability</b>)
</td></tr>
<tr>
<td valign="top"> <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.period <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;STRING&gt;</i></a></span>
</td>
<td> 0
</td>
<td valign="top"> The period with which the vehicle shall be rerouted
</td></tr>
<tr>
<td valign="top"> <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.pre-period <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;STRING&gt;</i></a></span>
</td>
<td> 60
</td>
<td valign="top"> The rerouting period before insertion/depart
</td></tr>
<tr>
<td valign="top"> <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.adaptation-interval <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;INT&gt;</i></a></span>
</td>
<td> 1
</td>
<td valign="top">  The interval for updating the edge weights.
</td></tr>
<tr>
<td valign="top"> <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.adaptation-weight <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;FLOAT&gt;</i></a></span>
</td>
<td> 0.5
</td>
<td valign="top">  The weight of prior edge weights for exponential averaging from [0, 1].
</td></tr>
<tr>
<td valign="top"> <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.adaptation-steps <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;INT&gt;</i></a></span>
</td>
<td> 0
</td>
<td valign="top">  The number of adaptation steps for averaging (enable for values &gt; 0).
</td></tr>
<tr>
<td valign="top"> <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.with-taz</span>
</td>
<td> false
</td>
<td valign="top"> Use <a href="../Demand/Importing_O/D_Matrices.html#Describing_the_TAZ" title="Demand/Importing O/D Matrices">traffic assignment zones (TAZ/districts)</a> as routing end points
</td></tr>
<tr>
<td valign="top"> <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.init-with-loaded-weights</span>
</td>
<td> false
</td>
<td valign="top"> Use option <span style="color: #111144; font-weight: bold; white-space: pre;">--weight-files</span> for initializing the edge weights at simulation start
</td></tr>
</table>
<h1><span class="mw-headline" id="Edge_weights">Edge weights</span></h1>
<p>If the routing is enabled for any vehicles, the average travel times in the net are collected for all edges. If a vehicle needs to be routed (either because it gets inserted or because a repeated route choice was enabled via the ".period" option) it chooses the fastest route to its destination edge (or district) according to the present edge weights (travel speeds and hence travel times). The update of the edge weights does not simply overwrite the old value but is computed as a weighted average as described below. Since updating the weights of all edges in each simulation step means a major slowdown for the simulation this interval may be altered using the ".adaptation-interval" option.
</p>
<div style="background: #ffffdd; padding: .5em; border: 1px dashed #ffcc44; margin-right:10px; margin-left:10px;"><b>Note:</b><br />these weights are also used when using <a href="../TraCI.html" title="TraCI">TraCI</a> functions <i>vehicle.rerouteTraveltime</i> and <i>vehicle.changeTarget</i> if the routing mode was set to <i>ROUTING_MODE_AGGREGATED</i> using <i>vehicle.setRoutingMode</i>.</div>
<h2><span class="mw-headline" id="Adapting_by_exponential_average">Adapting by exponential average</span></h2>
<p>By setting the option <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.adaptation-weight <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;FLOAT&gt;</i></a></span> the travel speed of each edge is computed as
</p>
<pre> FLOAT * priorValue + (1 - FLOAT) * currentMeanSpeed
</pre>
<p>This averaging takes place with the period set by <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.adaptation-interval</span>.
</p>
<h2><span class="mw-headline" id="Adapting_by_moving_average">Adapting by moving average</span></h2>
<p>By setting the option <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.adaptation-steps <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;INT&gt;</i></a></span> the travel speed of each edge is computed as the average of the INT latest meanSpeed values.
This averaging takes place with the period set by <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.adaptation-interval</span>.
</p>
<div style="background: #ffffdd; padding: .5em; border: 1px dashed #ffcc44; margin-right:10px; margin-left:10px;"><b>Note:</b><br />speed values in a time interval going back as far as the multiple of <b>adaptation-interval</b> and <b>adaptation-steps</b> take part in the averaging.</div>
<h2><span class="mw-headline" id="Investigating_edge_weights">Investigating edge weights</span></h2>
<p>To understand the evolution of edge weights during the simulation it can be helpful to look at the values in detail:
</p>
<ul><li> used road coloring <i>by routing device assumed speed</i> in <a href="../SUMO-GUI.html#Changing_the_appearance.2Fvisualisation_of_the_simulation" title="SUMO-GUI">SUMO-GUI</a></li>
<li> use option <span style="color: #111144; font-weight: bold; white-space: pre;">--device.rerouting.output <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;FILE&gt;</i></a></span> to get the raw numbers</li>
<li> use <a href="../TraCI/Vehicle_Value_Retrieval.html#Supported_Device_Parameters" title="TraCI/Vehicle Value Retrieval">TraCI function <i>vehicle.getParameter("device.rerouting.edge:EDGEID")</i></a> to retrieve the averaged traveltime value for individual edges</li></ul>
<h1><span class="mw-headline" id="Incomplete_trips_and_flows">Incomplete trips and flows</span></h1>
<p>All vehicles which are created using a trip as input (or a flow with "from" and "to" attributes) get automatically routed at insertion without the need to instantiate the device for them explicitly. Whenever an error occurs on routing because no route can be found which includes all mandatory edges ("from", "to", and all stop edges in the correct order) and is connected (also respecting the vehicle class permissions) this is a fatal error and stops th simulation. This can be switched off by using <span style="color: #111144; font-weight: bold; white-space: pre;">--ignore-route-errors</span> which will leave the route untouched in the error case. If the vehicle did not have a route yet (because it was defined using a trip) and cannot find one and <span style="color: #111144; font-weight: bold; white-space: pre;">--ignore-route-errors</span> is used, it will not be inserted.
</p><p>Alternatively to using attributes "from" and "to" it is also possible to use "fromTaz" and "toTaz", if a <a href="../Demand/Importing_O/D_Matrices.html#Describing_the_TAZ" title="Demand/Importing O/D Matrices">district file is loaded</a>.
</p>
<h1><span class="mw-headline" id="Alternative_Declaration_via_Parameters">Alternative Declaration via Parameters</span></h1>
<p>Another way for defining the set of vehicles that are equipped with a rerouting device is via <a href="../Definition_of_Vehicles,_Vehicle_Types,_and_Routes.html#Devices" title="Definition of Vehicles, Vehicle Types, and Routes">generic parameters</a>.
</p>
<h1><span class="mw-headline" id="TraCI">TraCI</span></h1>
<p>The device can be accessed using the TraCI function <i>vehicle.getParameter</i> and <i>vehicle.setParameter</i>:
</p><p><b>getParameter</b>
</p>
<ul><li> device.rerouting.period (returns individual rerouting period in seconds)</li>
<li> device.rerouting.edge:EDGE_ID (returns assumed travel time for rerouting where EDGE_ID is the id of a network edge)</li>
<li> has.rerouting.device (returns "true" or "false" depending on whether the device is equipped)</li></ul>
<p><b>setParameter</b>
</p>
<ul><li> device.rerouting.period (double literal, set rerouting period in seconds)</li>
<li> device.rerouting.edge:EDGE_ID (double literal, set assumed travel time for rerouting for all vehicles (where EDGE_ID is the id if a network edge). This value is overwritten at the next update interval (--device.rerouting.adaptation-interval).</li>
<li> has.rerouting.device ("true"): can be used to dynamically enable automatic rerouting</li></ul>
<h1><span class="mw-headline" id="Randomness">Randomness</span></h1>
<p>When setting the option <span style="color: #111144; font-weight: bold; white-space: pre;">--weights.random-factor <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;FLOAT&gt;</i></a></span>, edge weights for routing are dynamically distorted by a random factor drawn uniformly from [1,<a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;FLOAT&gt;</i></a>]. This randomization is performed every time an edge weight is used so the same vehicle could select a different route when rerouted on different time steps. The route generated this way may be longer than the fastest route by the given factor (in the worst case).
This randomness is a good way to achieve a reasonable route distribution in grid networks an in other cases where many similar route alternatives are available.
</p>
<!-- 
NewPP limit report
CPU time usage: 0.048 seconds
Real time usage: 0.046 seconds
Preprocessor visited node count: 199/1000000
Preprocessor generated node count: 580/1000000
Postâ€expand include size: 3832/2097152 bytes
Template argument size: 1522/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   18.718      1 - -total
 67.26%   12.590     19 - Template:Option
  8.70%    1.628      2 - Template:Note
  8.64%    1.617      5 - Template:DT_FLOAT
  8.19%    1.533      3 - Template:DT_INT
  7.86%    1.471      3 - Template:DT_STR
  7.35%    1.375      1 - Template:DT_FILE
-->

<!-- Saved in parser cache with key sumoSimWiki:pcache:idhash:333-0!*!0!!en!*!* and timestamp 20181010092604 and revision id 11040
 -->
</div>									</div><hr/><div id="lastmod">This page was last modified on 31 July 2018, at 09:34.</div>